const MAX_WORD_CHAR_COUNT=45;var gameFailed,clickSound,winSound,isConnected=!1,connectedChannel="",time_Slider_Value=1,display_ChosenWord="--Game Has Not Started--",chosenWord="",image_src_link="",wordFound=!1,intervalTimer=null,roundIsActive=!1,random_word_list_keys=[],word_obj_concat={},word_cur_index=0,canDoLocalStorage=!0,hasSeenWord=!1,img_height=140,img_word=new Image,pop_window=null;$(document).ready(function(){for(var e in $('[data-toggle="tooltip"]').tooltip(),list_of_categories)list_of_categories[e].state=document.getElementById(list_of_categories[e].id).checked;document.getElementById("timer_Spinner").addEventListener("input",timer_slider_num_show,!1),time_Slider_Value=4*document.getElementById("timer_Spinner").value,(clickSound=document.getElementById("btn_click_s")).volume=.2,(winSound=document.getElementById("lose_s")).volume=.9,document.getElementById("main_btn").addEventListener("click",StartGame),img_word.onload=function(){var e=this.width/this.height,t=img_height*e;document.getElementById("image_place").innerHTML='<img id="word_image_main" class="margin_center" src="'+img_word.src+'" height="'+img_height+'" width="'+t+'" style="visibility: hidden;">'},img_word.onerror=function(){this.src="images/blank.png"},Setup_Shuffle_Words()});const{chat:chat,api:api}=new TwitchJs({log:{enabled:!1,clientId:"gcxxg3g0lghqxl0d4zhttv11sobtf8"}});function StartGame(){ConnectTwitchChat()}function Game_Started(){document.getElementById("main_btn").value="Next Word",document.getElementById("main_btn").removeEventListener("click",StartGame),document.getElementById("main_btn").addEventListener("click",NextRound),NextRound()}function NextRound(){isConnected||ConnectTwitchChat(),gameFailed=!1,roundIsActive=!0,PickWord(),StopTimer(),PopOutWord(),StartTimer(time_Slider_Value),document.getElementById("timer_ouput").style.color="#4682B4",document.getElementById("word_image_main").style.visibility="hidden",Error_Notify("","",!0),clickSound.play()}function ConnectTwitchChat(){const e=document.getElementById("channelName").value;if(isConnected)chat.reconnect().then(()=>{chat.part(connectedChannel),chat.join(e),connectedChannel=e});else{const t=e=>{if("PRIVMSG"===e.event&&!wordFound&&null!=e.message&&!gameFailed){var t=DOMPurify.sanitize(e.message,{ALLOWED_TAGS:["b"]});document.getElementById("wb_output").innerHTML='<strong class="font_pop" style="color:'+e.tags.color+'; ">'+e.username+"</strong>: "+t,-1!=t.toLowerCase().search("^"+chosenWord)&&WordGuessed()}};chat.on(TwitchJs.Chat.Events.ALL,t),chat.connect().then(()=>{chat.join(e).then(({roomState:t})=>{isConnected=!0,connectedChannel=e,Game_Started()}).catch(function(e){Error_Notify("Make Sure Channel Name Is Filled Correctly.",e,!1)})}).catch(function(e){Error_Notify("Could Not Connect To Twtich API.",e,!1)})}}function Error_Notify(e,t,o=!1){o?document.getElementById("wb_error_msg_box").style.visibility="hidden":(document.getElementById("wb_error_msg_box").style.visibility="visible",document.getElementById("error_msg").innerHTML=e,console.log(t))}function StartTimer(e){var t,o,n=e,r=function(){t=parseInt(n/60,10),o=(o=parseInt(n%60,10))<10?"0"+o:o,document.getElementById("timer_ouput").innerHTML=t+":"+o,--n<0&&(n=0,WordNotGuessed())};r(),intervalTimer=setInterval(r,1e3)}function StopTimer(){null!=intervalTimer&&clearInterval(intervalTimer)}function Setup_Shuffle_Words(){for(var e in word_cur_index=0,random_word_list_keys=[],word_obj_concat={},list_of_categories)if(1==list_of_categories[e].state)if(list_of_categories[e]instanceof Dynamic_Category){var t=list_of_categories[e].getWords();-1!=t&&(word_obj_concat=Object.assign(word_obj_concat,t))}else word_obj_concat=Object.assign(word_obj_concat,list_of_categories[e].words);random_word_list_keys=shuffleWords(Object.keys(word_obj_concat))}function PickWord(){wordFound=!1,chosenWord=random_word_list_keys[word_cur_index],image_src_link=word_obj_concat[chosenWord],++word_cur_index==random_word_list_keys.length&&Setup_Shuffle_Words(),""==image_src_link&&(image_src_link="images/blank.png"),img_word.src=image_src_link,document.getElementById("the_word").innerHTML="???",display_ChosenWord=chosenWord,Check_Seen_Word(chosenWord),updatePopoutWord(),chosenWord=(chosenWord=RegExp.escape(chosenWord)).toLowerCase()}function shuffleWords(e){var t,o,n;for(n=e.length-1;n>0;n--)t=Math.floor(Math.random()*(n+1)),o=e[n],e[n]=e[t],e[t]=o;return e}function WordGuessed(){console.log("WORD GUEESED!"),wordFound=!0,document.getElementById("timer_ouput").style.color="green";var e=document.getElementById("kids_hooray");e.volume=.5,RunConfetti(),e.play(),GameEnd()}async function RunConfetti(){confetti.maxCount=300,confetti.particleSpeed=3,confetti.start(),await new Promise(e=>{setTimeout(e,2e3)}),confetti.stop()}function WordNotGuessed(){!isConnected||gameFailed||wordFound||(console.log("WORD NOT GUESSED"),gameFailed=!0,document.getElementById("timer_ouput").style.color="red",document.getElementById("wb_output").innerHTML="...",winSound.play(),GameEnd())}function GameEnd(){StopTimer(),document.getElementById("the_word").innerHTML=display_ChosenWord,document.getElementById("word_image_main").style.visibility="visible",roundIsActive=!1}RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};var p=function(){var e=0,t=-1;for(var o in list_of_categories)1==list_of_categories[o].state&&e++,list_of_categories[o].id==this.id&&(t=o);1==e&&1==list_of_categories[t].state?$("#"+this.id).bootstrapToggle("on",!0):(list_of_categories[t].state=!list_of_categories[t].state,1==list_of_categories[t].state&&list_of_categories[t]instanceof Dynamic_Category?($("#"+this.id).bootstrapToggle("off",!0),list_of_categories[t].state=!1,list_of_categories[t].show_modal()):Setup_Shuffle_Words())};function PopOutWord(){null==pop_window||pop_window.closed?pop_window=window.open("popout_word.html","PopUpWindow_TCharadesGame","height=380,width=680,left=100,top=100,menubar=no,location=no,directories=no, status=yes"):pop_window.focus()}function SetPopOut(e){pop_window=e,SetPopOutValues()}function updatePopoutWord(){null!=pop_window&&(SetPopOutValues(),pop_window.focus())}function SetPopOutValues(){pop_window.Set_Word(display_ChosenWord,image_src_link,canDoLocalStorage?hasSeenWord:null)}function Check_Seen_Word(e){if(canDoLocalStorage)try{null!=localStorage.getItem(e)?hasSeenWord=!0:(localStorage.setItem(e,""),hasSeenWord=!1)}catch(e){console.log(e),canDoLocalStorage=!1}}function Clear_Seen_all(){localStorage.clear()}window.onbeforeunload=function(){null!=pop_window&&pop_window.close()};var tabs_hide=!1;function HideAllTabs(){if(tabs_hide){for(e=document.getElementsByClassName("hidden_tab");e.length>0;)e[0].classList.remove("hidden_tab");document.getElementById("note_notes").classList.add("visible_tab"),document.getElementById("categories_settings").classList.add("visible_tab"),document.getElementById("hide_all_tabs_btn").value="Hide All"}else{for(var e=document.getElementsByClassName("visible_tab");e.length>0;)e[0].classList.remove("visible_tab");document.getElementById("note_notes").classList.add("hidden_tab"),document.getElementById("categories_settings").classList.add("hidden_tab"),document.getElementById("hide_all_tabs_btn").value="Show All"}tabs_hide=!tabs_hide}function timer_slider_num_show(){time_Slider_Value=4*document.getElementById("timer_Spinner").value,minutes=parseInt(time_Slider_Value/60,10),seconds=parseInt(time_Slider_Value%60,10),seconds=seconds<10?"0"+seconds:seconds,$("#div_spinner_time").tooltip("show"),$("#div_spinner_time").tooltip().attr("data-original-title",minutes+":"+seconds)}function openInNewTab(e){window.open(e,"_blank").focus()}function UpdateErrorText(e,t,o){if(elemTextToUpdate=document.getElementById(t),!elemTextToUpdate)return!1;var n="";o||(n=e),elemTextToUpdate.innerText=n,elemTextToUpdate.style.display=elemTextToUpdate.getAttribute("defaultdisplay")}function CustomWords_GetEmotes(){if(cus_ErrorText=document.getElementById("Cus_AdvancedTools_Emotes_ErrorText"),cus_ErrorText.value="",cus_ErrorText.style.display="none",1==roundIsActive)return cus_ErrorText.innerText="Please, wait until the current round timer is over, before using that.",cus_ErrorText.style.display="block",!1;let e=new XMLHttpRequest;var t,o;e.onreadystatechange=function(e){if(4==e.target.readyState){if(200==e.target.status){var t=JSON.parse(e.target.response);if(t.channelEmotes&&t.sharedEmotes){if(0==t.channelEmotes.length&&0==t.sharedEmotes.length)return void UpdateErrorText("User has no emotes.","Cus_AdvancedTools_Emotes_ErrorText")}else if(0==t.length)return void UpdateErrorText("User has no emotes.","Cus_AdvancedTools_Emotes_ErrorText");let o="";1==document.getElementById("bttv_import_toggle").checked?(t.channelEmotes.forEach(function(e){o+=e.code+" > https://cdn.betterttv.net/emote/"+e.id+"/3x ::\n"}),t.sharedEmotes.forEach(function(e){o+=e.code+" > https://cdn.betterttv.net/emote/"+e.id+"/3x ::\n"})):1==document.getElementById("ffz_import_toggle").checked&&t.forEach(function(e){o+=e.code+" > ",null!=e.images["4x"]?o+=e.images["4x"]+" ::\n":null!=e.images["2x"]?o+=e.images["2x"]+" ::\n":null!=e.images["1x"]&&(o+=e.images["1x"]+" ::\n")}),customWords_textarea=document.getElementById("customWords_textarea"),customWords_textarea.setSelectionRange(customWords_textarea.value.length,customWords_textarea.value.length),customWords_textarea.focus(),"\n"==customWords_textarea.value[customWords_textarea.value.length-1]&&"\n"==customWords_textarea.value[customWords_textarea.value.length-2]||""==customWords_textarea.value?document.execCommand("insertText",!1,o):document.execCommand("insertText",!1,"\n\n"+o)}404==e.target.status&&UpdateErrorText("Error: "+JSON.parse(e.target.response).message,"Cus_AdvancedTools_Emotes_ErrorText")}},1==document.getElementById("bttv_import_toggle").checked?(t=document.getElementById("customwords_inputChannel_bttv").value,chat.connect().then(function(){chat.join(t).then(function({roomState:t}){o=t.roomId,chat.disconnect(),isConnected=!1,e.open("GET","https://api.betterttv.net/3/cached/users/twitch/"+o,!0),e.send()}).catch(function(e){UpdateErrorText("Error. Make sure that the channel name is correct!","Cus_AdvancedTools_Emotes_ErrorText"),console.log(e)})}).catch(function(e){UpdateErrorText("Could not connect to Twitch API.","Cus_AdvancedTools_Emotes_ErrorText"),console.log(e)})):1==document.getElementById("ffz_import_toggle").checked&&(t=document.getElementById("customwords_inputChannel_ffz").value,chat.connect().then(function(){chat.join(t).then(function({roomState:t}){o=t.roomId,chat.disconnect(),isConnected=!1,e.open("GET","https://api.betterttv.net/3/cached/frankerfacez/users/twitch/"+o,!0),e.send()}).catch(function(e){UpdateErrorText("Error. Make sure that the channel name is correct!","Cus_AdvancedTools_Emotes_ErrorText"),console.log(e)})}).catch(function(e){UpdateErrorText("Could not connect to Twitch API.","Cus_AdvancedTools_Emotes_ErrorText"),console.log(e)}))}document.getElementById("customwords_getEmotes_btn").addEventListener("click",CustomWords_GetEmotes);
